<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mode Exercise Game</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100%;
  overflow: hidden;
}

/* ================= VIDEO ================= */
#exerciseVideo {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
}

/* ================= EDGE PULSE ================= */
#edgePulse {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 20;
  box-shadow: inset 0 0 0 0 transparent;
}

.edge-slow {
  --edge-color: rgba(34,197,94,0.55);
  --edge-size: 18px;
}

.edge-medium {
  --edge-color: rgba(250,204,21,0.7);
  --edge-size: 26px;
}

.edge-fast {
  --edge-color: rgba(251,146,60,0.85);
  --edge-size: 34px;
}

.edge-veryfast {
  --edge-color: rgba(239,68,68,1);
  --edge-size: 46px;
}

.edge-pulse {
  animation: edgePulse 180ms ease-out;
}

@keyframes edgePulse {
  from {
    box-shadow:
      inset 0 0 0 var(--edge-size) var(--edge-color);
  }
  to {
    box-shadow:
      inset 0 0 0 0 rgba(0,0,0,0);
  }
}

/* ================= RADIAL FLASH ================= */
#radialFlash {
  position: fixed;
  inset: 0;
  pointer-events: none;
  opacity: 0;
  z-index: 25;
}

.flash-slow {
  background: radial-gradient(circle,
    rgba(34,197,94,0.45) 0%,
    rgba(0,0,0,0) 70%);
}

.flash-medium {
  background: radial-gradient(circle,
    rgba(250,204,21,0.55) 0%,
    rgba(0,0,0,0) 70%);
}

.flash-fast {
  background: radial-gradient(circle,
    rgba(251,146,60,0.65) 0%,
    rgba(0,0,0,0) 70%);
}

.flash-veryfast {
  background: radial-gradient(circle,
    rgba(239,68,68,0.75) 0%,
    rgba(0,0,0,0) 70%);
}

.flash {
  animation: flash 260ms ease-out;
}

@keyframes flash {
  from { opacity: 1; }
  to { opacity: 0; }
}

/* ================= START BUTTON ================= */
#overlay {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 30;
}

button {
  padding: 18px 28px;
  font-size: 1.2rem;
  font-weight: bold;
  border-radius: 14px;
  border: none;
  background: #2563eb;
  color: white;
}
</style>
</head>

<body>

<video id="exerciseVideo" muted playsinline></video>

<div id="edgePulse"></div>
<div id="radialFlash"></div>

<div id="overlay">
  <button id="start">Start</button>
</div>

<script>
/* ================= CONFIG ================= */
const MODES = ["Stop", "Slow", "Medium", "Fast", "Very Fast"];

const BPM = {
  Slow: 60,
  Medium: 100,
  Fast: 140,
  "Very Fast": 170
};

const VIBRATION = {
  Slow: 450,
  Medium: 700,
  Fast: 1000,
  "Very Fast": 1400
};

/* ================= ELEMENTS ================= */
const edgePulse = document.getElementById("edgePulse");
const radialFlash = document.getElementById("radialFlash");
const startBtn = document.getElementById("start");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let metronomeInterval;

/* ================= METRONOME ================= */
function startMetronome(bpm, mode) {
  clearInterval(metronomeInterval);
  if (!bpm) return;

  const interval = 60000 / bpm;

  metronomeInterval = setInterval(() => {
    const osc = audioCtx.createOscillator();
    osc.frequency.value = 1000;
    osc.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.05);

    triggerEdgePulse(mode);
    navigator.vibrate?.(VIBRATION[mode]);
  }, interval);
}

/* ================= VISUALS ================= */
function triggerEdgePulse(mode) {
  edgePulse.className = "";
  edgePulse.classList.add(
    mode === "Slow" ? "edge-slow" :
    mode === "Medium" ? "edge-medium" :
    mode === "Fast" ? "edge-fast" :
    mode === "Very Fast" ? "edge-veryfast" : ""
  );
  edgePulse.classList.add("edge-pulse");
}

function triggerRadialFlash(mode) {
  radialFlash.className = "";
  radialFlash.classList.add(
    mode === "Slow" ? "flash-slow" :
    mode === "Medium" ? "flash-medium" :
    mode === "Fast" ? "flash-fast" :
    mode === "Very Fast" ? "flash-veryfast" : ""
  );
  radialFlash.classList.add("flash");
}

/* ================= MODE LOOP ================= */
let modeIndex = 0;

function nextMode() {
  modeIndex = (modeIndex + 1) % MODES.length;
  const mode = MODES[modeIndex];

  triggerRadialFlash(mode);
  startMetronome(BPM[mode], mode);

  setTimeout(nextMode, 8000 + Math.random() * 12000);
}

/* ================= START ================= */
startBtn.onclick = async () => {
  startBtn.style.display = "none";
  await audioCtx.resume();
  document.documentElement.requestFullscreen?.();
  nextMode();
};
</script>

</body>
</html>
