<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mode Exercise Game</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100%;
  overflow: hidden;
}

/* ================= VIDEO ================= */
#exerciseVideo {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  z-index: 1;
}

/* ================= RADIAL FLASH ================= */
#radialFlash {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  opacity: 0;
  mix-blend-mode: screen;
}

.flash-slow {
  background: radial-gradient(circle,
    rgba(34,197,94,0.5) 0%,
    rgba(0,0,0,0) 65%);
}

.flash-medium {
  background: radial-gradient(circle,
    rgba(250,204,21,0.6) 0%,
    rgba(0,0,0,0) 65%);
}

.flash-fast {
  background: radial-gradient(circle,
    rgba(251,146,60,0.7) 0%,
    rgba(0,0,0,0) 65%);
}

.flash-veryfast {
  background: radial-gradient(circle,
    rgba(239,68,68,0.8) 0%,
    rgba(0,0,0,0) 65%);
}

.flash {
  animation: flash 260ms ease-out;
}

@keyframes flash {
  from { opacity: 1; }
  to { opacity: 0; }
}

/* ================= EDGE PULSE ================= */
#edgePulse {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 3;
}

.edge-slow {
  --edge-color: rgba(34,197,94,0.7);
  --edge-size: 28px;
}

.edge-medium {
  --edge-color: rgba(250,204,21,0.8);
  --edge-size: 40px;
}

.edge-fast {
  --edge-color: rgba(251,146,60,0.9);
  --edge-size: 52px;
}

.edge-veryfast {
  --edge-color: rgba(239,68,68,1);
  --edge-size: 66px;
}

.edge-pulse {
  animation: edgePulse 180ms ease-out;
}

@keyframes edgePulse {
  from {
    box-shadow: inset 0 0 0 var(--edge-size) var(--edge-color);
  }
  to {
    box-shadow: inset 0 0 0 0 rgba(0,0,0,0);
  }
}

/* ================= UI ================= */
#overlay {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
}

button {
  padding: 18px 28px;
  font-size: 1.2rem;
  font-weight: bold;
  border-radius: 14px;
  border: none;
  background: #2563eb;
  color: white;
}
</style>
</head>

<body>

<video
  id="exerciseVideo"
  muted
  playsinline
  webkit-playsinline
  loop
></video>

<div id="radialFlash"></div>
<div id="edgePulse"></div>

<div id="overlay">
  <button id="start">Start</button>
</div>

<script>
/* ================= EXERCISES ================= */
const EXERCISE_VIDEOS = {
  "Exercise 1": "1.mp4",
  "Exercise 2": "2.mp4",
  "Exercise 3": "3.mp4",
  "Exercise 4": "4.mp4",
  "Exercise 5": "5.mp4",
  "Exercise 6": "6.mp4",
  "Exercise 7": "7.mp4",
  "Exercise 8": "8.mp4",
  "Exercise 9": "9.mp4",
  "Exercise 10": "10.mp4",
  "Exercise 11": "11.mp4",
  "Exercise 12": "12.mp4",
  "Exercise 13": "13.mp4",
  "Exercise 14": "14.mp4",
  "Exercise 15": "15.mp4"
};

const EXERCISES = Object.keys(EXERCISE_VIDEOS);

/* ================= MODES ================= */
const MODES = ["Slow", "Medium", "Fast", "Very Fast"];

const BPM = {
  Slow: 60,
  Medium: 100,
  Fast: 140,
  "Very Fast": 170
};

/* ================= ELEMENTS ================= */
const video = document.getElementById("exerciseVideo");
const edgePulse = document.getElementById("edgePulse");
const radialFlash = document.getElementById("radialFlash");
const startBtn = document.getElementById("start");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let metronomeInterval;

/* ================= RANDOMIZATION ================= */
let exerciseDeck = [];
let lastExercise = null;

function shuffle(array) {
  const a = [...array];
  for (let i = a.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function nextExercise() {
  if (!exerciseDeck.length) {
    exerciseDeck = shuffle(EXERCISES);
    if (exerciseDeck[0] === lastExercise && exerciseDeck.length > 1) {
      [exerciseDeck[0], exerciseDeck[1]] =
      [exerciseDeck[1], exerciseDeck[0]];
    }
  }
  lastExercise = exerciseDeck.shift();
  return lastExercise;
}

/* ================= VIDEO ================= */
function playExerciseVideo(name) {
  video.src = EXERCISE_VIDEOS[name];
  video.load();
  video.play().catch(() => {});
}

/* ================= VISUALS ================= */
function triggerEdgePulse(mode) {
  edgePulse.className = "";
  edgePulse.classList.add(
    mode === "Slow" ? "edge-slow" :
    mode === "Medium" ? "edge-medium" :
    mode === "Fast" ? "edge-fast" :
    "edge-veryfast",
    "edge-pulse"
  );
}

function triggerRadialFlash(mode) {
  radialFlash.className = "";
  radialFlash.classList.add(
    mode === "Slow" ? "flash-slow" :
    mode === "Medium" ? "flash-medium" :
    mode === "Fast" ? "flash-fast" :
    "flash-veryfast",
    "flash"
  );
}

/* ================= METRONOME ================= */
function startMetronome(bpm, mode) {
  clearInterval(metronomeInterval);
  metronomeInterval = setInterval(() => {
    const osc = audioCtx.createOscillator();
    osc.frequency.value = 1000;
    osc.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.05);
    triggerEdgePulse(mode);
  }, 60000 / bpm);
}

/* ================= FLOW ================= */
let modeIndex = 0;

function nextMode() {
  const mode = MODES[modeIndex++ % MODES.length];
  triggerRadialFlash(mode);
  startMetronome(BPM[mode], mode);
  setTimeout(nextMode, 8000);
}

/* ================= START ================= */
startBtn.onclick = async () => {
  startBtn.style.display = "none";
  document.documentElement.requestFullscreen?.();
  await audioCtx.resume();

  playExerciseVideo(nextExercise());
  nextMode();

  setInterval(() => {
    playExerciseVideo(nextExercise());
  }, 45000);
};
</script>

</body>
</html>
