<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mode Exercise Game</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100%;
  overflow: hidden;
}

/* ================= VIDEO ================= */
#exerciseVideo {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  object-fit: cover;
  z-index: 1;
}

/* ================= RADIAL FLASH ================= */
#radialFlash {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 2;
  opacity: 0;
  mix-blend-mode: screen;
}

.flash-slow {
  background: radial-gradient(circle,
    rgba(34,197,94,0.45) 0%,
    rgba(0,0,0,0) 65%);
}

.flash-medium {
  background: radial-gradient(circle,
    rgba(250,204,21,0.55) 0%,
    rgba(0,0,0,0) 65%);
}

.flash-fast {
  background: radial-gradient(circle,
    rgba(251,146,60,0.65) 0%,
    rgba(0,0,0,0) 65%);
}

.flash-veryfast {
  background: radial-gradient(circle,
    rgba(239,68,68,0.75) 0%,
    rgba(0,0,0,0) 65%);
}

.flash {
  animation: flash 260ms ease-out;
}

@keyframes flash {
  from { opacity: 1; }
  to { opacity: 0; }
}

/* ================= EDGE PULSE ================= */
#edgePulse {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 3;
}

.edge-slow {
  --edge-color: rgba(34,197,94,0.6);
  --edge-size: 24px;
}

.edge-medium {
  --edge-color: rgba(250,204,21,0.7);
  --edge-size: 34px;
}

.edge-fast {
  --edge-color: rgba(251,146,60,0.8);
  --edge-size: 44px;
}

.edge-veryfast {
  --edge-color: rgba(239,68,68,0.9);
  --edge-size: 56px;
}

.edge-pulse {
  animation: edgePulse 180ms ease-out;
}

@keyframes edgePulse {
  from {
    box-shadow: inset 0 0 0 var(--edge-size) var(--edge-color);
  }
  to {
    box-shadow: inset 0 0 0 0 rgba(0,0,0,0);
  }
}

/* ================= UI ================= */
#overlay {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
}

button {
  padding: 18px 28px;
  font-size: 1.2rem;
  font-weight: bold;
  border-radius: 14px;
  border: none;
  background: #2563eb;
  color: white;
}
</style>
</head>

<body>

<video
  id="exerciseVideo"
  muted
  playsinline
  webkit-playsinline
  loop
></video>

<div id="radialFlash"></div>
<div id="edgePulse"></div>

<div id="overlay">
  <button id="start">Start</button>
</div>

<script>
/* ================= CONFIG ================= */
const EXERCISES = Array.from({ length: 15 }, (_, i) => `Exercise ${i + 1}`);
const EXERCISE_VIDEOS = Object.fromEntries(
  EXERCISES.map((e, i) => [e, `${i + 1}.mp4`])
);

const MODES = ["Slow", "Medium", "Fast", "Very Fast"];

const BPM = {
  Slow: 60,
  Medium: 100,
  Fast: 140,
  "Very Fast": 170
};

/* ================= ELEMENTS ================= */
const video = document.getElementById("exerciseVideo");
const edgePulse = document.getElementById("edgePulse");
const radialFlash = document.getElementById("radialFlash");
const startBtn = document.getElementById("start");

const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
let metronomeInterval;

/* ================= VIDEO ================= */
function playExerciseVideo(name) {
  video.src = EXERCISE_VIDEOS[name];
  video.load();
  video.play().catch(() => {});
}

/* ================= VISUALS ================= */
function triggerEdgePulse(mode) {
  edgePulse.className = "";
  edgePulse.classList.add(
    mode === "Slow" ? "edge-slow" :
    mode === "Medium" ? "edge-medium" :
    mode === "Fast" ? "edge-fast" :
    "edge-veryfast",
    "edge-pulse"
  );
}

function triggerRadialFlash(mode) {
  radialFlash.className = "";
  radialFlash.classList.add(
    mode === "Slow" ? "flash-slow" :
    mode === "Medium" ? "flash-medium" :
    mode === "Fast" ? "flash-fast" :
    "flash-veryfast",
    "flash"
  );
}

/* ================= METRONOME ================= */
function startMetronome(bpm, mode) {
  clearInterval(metronomeInterval);
  metronomeInterval = setInterval(() => {
    const osc = audioCtx.createOscillator();
    osc.frequency.value = 1000;
    osc.connect(audioCtx.destination);
    osc.start();
    osc.stop(audioCtx.currentTime + 0.05);
    triggerEdgePulse(mode);
  }, 60000 / bpm);
}

/* ================= FLOW ================= */
let modeIndex = 0;

function nextMode() {
  const mode = MODES[modeIndex++ % MODES.length];
  triggerRadialFlash(mode);
  startMetronome(BPM[mode], mode);
  setTimeout(nextMode, 8000);
}

/* ================= START ================= */
startBtn.onclick = async () => {
  startBtn.style.display = "none";
  document.documentElement.requestFullscreen?.();
  await audioCtx.resume();
  playExerciseVideo("Exercise 1");
  nextMode();
};
</script>

</body>
</html>
