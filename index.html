<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mode Exercise Game</title>

<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#000000" />

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100%;
  overflow: hidden;
}

/* ===== VIDEO CONTAINER ===== */
#videoContainer {
  position: fixed;
  inset: 0;
  width: 100vw;
  height: 100vh;
  background: black;
}

#exerciseVideo {
  width: 100%;
  height: 100%;
  object-fit: cover;
  background: black;
}

video::-webkit-media-controls {
  display: none !important;
}

#overlay {
  position: fixed;
  inset: 0;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
  pointer-events: none;
}

button {
  pointer-events: auto;
  padding: 18px 28px;
  font-size: 1.2rem;
  font-weight: bold;
  border-radius: 14px;
  border: none;
  background: #2563eb;
  color: white;
}

/* ===== BEAT PULSE ===== */
#beatPulse {
  position: absolute;
  transform: translate(-50%, -50%) scale(1);
  border-radius: 50%;
  opacity: 1;
  z-index: 15;
  pointer-events: none;
}

/* ===== PULSE MODES ===== */
.pulse-slow {
  background: #22c55e;
  width: 36px;
  height: 36px;
  --pulse-scale: 2.6;
}

.pulse-medium {
  background: #facc15;
  width: 50px;
  height: 50px;
  --pulse-scale: 3.2;
}

.pulse-fast {
  background: #fb923c;
  width: 62px;
  height: 62px;
  --pulse-scale: 3.8;
}

.pulse-veryfast {
  background: #ef4444;
  width: 80px;
  height: 80px;
  --pulse-scale: 4.6;
}

.pulse {
  animation: pulse 420ms cubic-bezier(0.2, 0.8, 0.2, 1);
}

@keyframes pulse {
  from {
    transform: translate(-50%, -50%) scale(1);
  }
  to {
    transform: translate(-50%, -50%) scale(var(--pulse-scale));
  }
}
</style>
</head>

<body>

<div id="videoContainer">
  <video id="exerciseVideo" playsinline webkit-playsinline muted preload="auto"></video>
  <div id="beatPulse"></div>
</div>

<div id="overlay">
  <button id="start">Start</button>
</div>

<script>
/* ================= ELEMENTS ================= */
const videoEl = document.getElementById("exerciseVideo");
const beatPulse = document.getElementById("beatPulse");

/* ================= LOCK PULSE TO VIDEO CENTER ================= */
function updatePulsePosition() {
  if (!videoEl.videoWidth || !videoEl.videoHeight) return;

  const container = videoEl.getBoundingClientRect();
  const videoRatio = videoEl.videoWidth / videoEl.videoHeight;
  const containerRatio = container.width / container.height;

  let displayWidth, displayHeight;

  if (containerRatio > videoRatio) {
    displayWidth = container.width;
    displayHeight = container.width / videoRatio;
  } else {
    displayHeight = container.height;
    displayWidth = container.height * videoRatio;
  }

  const offsetX = (container.width - displayWidth) / 2;
  const offsetY = (container.height - displayHeight) / 2;

  beatPulse.style.left = offsetX + displayWidth / 2 + "px";
  beatPulse.style.top  = offsetY + displayHeight / 2 + "px";
}

videoEl.addEventListener("loadedmetadata", updatePulsePosition);
window.addEventListener("resize", updatePulsePosition);

/* ================= PULSE LOGIC ================= */
function setPulseStyle(mode) {
  beatPulse.className = "";
  if (mode === "Slow") beatPulse.classList.add("pulse-slow");
  if (mode === "Medium") beatPulse.classList.add("pulse-medium");
  if (mode === "Fast") beatPulse.classList.add("pulse-fast");
  if (mode === "Very Fast") beatPulse.classList.add("pulse-veryfast");
}

function triggerPulse() {
  beatPulse.classList.remove("pulse");
  void beatPulse.offsetWidth;
  beatPulse.classList.add("pulse");
}

/* ================= DEMO START ================= */
document.getElementById("start").addEventListener("click", () => {
  videoEl.src = "1.mp4"; // example
  videoEl.play();
  setPulseStyle("Medium");
  setInterval(triggerPulse, 600);
});
</script>
</body>
</html>
